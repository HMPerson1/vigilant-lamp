<div class="content fill-screen" role="main" style="width: 100%; padding: 4px; display: flex; overflow: hidden;">
  <div class="groove-border" style="flex: 4; background-color: black;" (wheel)="$event.preventDefault()">
    <div style="display: flex; flex-direction: column; position: relative; width: 100%; height: 100%; overflow: hidden;"
      (mousemove)="visCursorX = $event.offsetX" (mouseleave)="visCursorX = undefined">
      <app-audio-waveform [audioData]="audioData" [(timeMin)]="vizTimeMin" [(timeMax)]="vizTimeMax"
        (click)="onWaveformClick($event)"></app-audio-waveform>
      <mat-divider style="border-color: gray;"></mat-divider>
      <app-audio-spectrogram style="flex: 1;" [audioData]="audioData" [(timeMin)]="vizTimeMin" [(timeMax)]="vizTimeMax"
        [(pitchMin)]="specPitchMin" [(pitchMax)]="specPitchMax" [specDbMin]="specDbMin" [specDbMax]="specDbMax"
        [fftLgWindowSize]="specLgWindowSize" [timeStep]="specTimeStep" [fftLgExtraPad]="specLgExtraPad"
        [showPitchGrid]="showPitchGrid" [pitchLabelType]="pitchLabelType" [showCrosshair]="showCrosshair"
        [showOvertones]="showOvertones" [debug_downsample]="debug_downsample"></app-audio-spectrogram>
      <div class="crosshair" style="width: 1px; background-color: red;"
        [style.left.%]="100 * (playheadPos - vizTimeMin) / (vizTimeMax - vizTimeMin)"></div>
      <div class="crosshair" style="width: 1px;" [style.left.px]="visCursorX || 0"
        [hidden]="!showCrosshair || visCursorX === undefined"></div>
    </div>
  </div>
  <div class="groove-border settings-panel"
    style="flex: 1; padding: 8px; display: flex; flex-direction: column; gap: 16px;">
    <div class="file-toolbar" style="display: flex; gap: 8px;">
      <button mat-icon-button matTooltip="New Project" color="primary" (click)="newProject()">
        <mat-icon>note_add</mat-icon>
      </button>
      <button mat-icon-button matTooltip="Open" color="primary" (click)="loadProject()">
        <mat-icon>file_open</mat-icon>
      </button>
      <button mat-icon-button matTooltip="Save" color="primary" (click)="saveProject()" [disabled]="!project">
        <mat-icon>save</mat-icon>
      </button>
      <button mat-icon-button matTooltip="Save As" color="primary" (click)="saveProject(true)" [disabled]="!project">
        <mat-icon>save_as</mat-icon>
      </button>
      <div style="padding: 4px" [hidden]="!loading">
        <mat-progress-spinner mode="indeterminate" style="width: 40px; height: 40px"></mat-progress-spinner>
      </div>
      <button mat-icon-button style="margin-left: auto;" matTooltip="Settings" color="primary" (click)="openSettings()" [disabled]="!project">
        <mat-icon>settings</mat-icon>
      </button>
    </div>
    <div class="playback-toolbar" style="display: flex; align-items: center; gap: 8px;">
      <button mat-icon-button [matTooltip]="audioBufSrcNode ? 'Pause' : 'Play'" (click)="playPauseClicked()"
        [disabled]="!audioFile">
        <mat-icon *ngIf="!audioBufSrcNode">play_arrow</mat-icon>
        <mat-icon *ngIf="audioBufSrcNode">pause</mat-icon>
      </button>
      <button mat-icon-button matTooltip="Stop" (click)="stopClicked()" [disabled]="!audioBufSrcNode">
        <mat-icon>stop</mat-icon>
      </button>
      <button mat-icon-button [matTooltip]="muted ? 'Unmute' : 'Mute'" (click)="muteClicked()" [disabled]="!audioFile">
        <mat-icon *ngIf="!muted">volume_up</mat-icon>
        <mat-icon *ngIf="muted">volume_off</mat-icon>
      </button>
      <mat-slider style="flex: 1" min="0" max="100" step="1">
        <input matSliderThumb [(ngModel)]="volumePct">
      </mat-slider>
    </div>
    <div style="display: flex; flex-direction: column;">
      <label>
        Spectral Power Scale
        <mat-slider min="-100" max="10" step="1">
          <input matSliderStartThumb [(ngModel)]="specDbMin">
          <input matSliderEndThumb [(ngModel)]="specDbMax">
        </mat-slider>
      </label>
      <label>
        Time vs. Frequency Resolution
        <mat-slider min="10" max="16" step="0.5">
          <input matSliderThumb [(ngModel)]="specLgWindowSize">
        </mat-slider>
      </label>
      <label>
        Time Sampling
        <mat-slider min="0" [max]="TIME_STEP_INPUT_MAX" step="1">
          <input matSliderThumb [(ngModel)]="specTimeStepInput">
        </mat-slider>
      </label>
      <label>
        Freqency Sampling
        <mat-slider min="-1" max="3" step="1">
          <input matSliderThumb [(ngModel)]="specLgExtraPad">
        </mat-slider>
      </label>
      <label class="inline-comp">
        Cursor Crosshair
        <mat-slide-toggle [(ngModel)]="showCrosshair"></mat-slide-toggle>
      </label>
      <label class="inline-comp">
        Cursor Overtones
        <mat-slide-toggle [(ngModel)]="showOvertones" [disabled]="!showCrosshair"></mat-slide-toggle>
      </label>
      <label class="inline-comp">
        Pitch Grid
        <mat-slide-toggle [(ngModel)]="showPitchGrid"></mat-slide-toggle>
      </label>
      <label class="inline-comp">
        Pitch Labels
        <mat-button-toggle-group [(ngModel)]="pitchLabelType">
          <mat-button-toggle value="none">None</mat-button-toggle>
          <mat-button-toggle value="midi">MIDI</mat-button-toggle>
          <mat-button-toggle value="sharp">&sharp;</mat-button-toggle>
          <mat-button-toggle value="flat">&flat;</mat-button-toggle>
        </mat-button-toggle-group>
      </label>
      <label style="display: none;" class="inline-comp">
        [DEBUG] downsample
        <mat-button-toggle-group [(ngModel)]="debug_downsample">
          <mat-button-toggle value="0">0</mat-button-toggle>
          <mat-button-toggle value="1">1</mat-button-toggle>
          <mat-button-toggle value="2">2</mat-button-toggle>
        </mat-button-toggle-group>
      </label>
    </div>
    <div style="margin-top: auto;">
      <div> Secure context: {{ secCtx }} </div>
      <div> Cross-origin isolated: {{ coi }} </div>
      <div> AudioContext sample rate: {{ audioContext.sampleRate }} </div>
      <div> Hardware concurrency: {{ hwCcur }} </div>
    </div>
  </div>
</div>
