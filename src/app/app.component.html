<div class="content fill-screen" role="main" style="width: 100%; padding: 4px; display: flex; overflow: hidden;">
  <div class="groove-border" style="flex: 4; background-color: black;" (wheel)="$event.preventDefault()">
    <div style="display: flex; flex-direction: column; position: relative; width: 100%; height: 100%;"
      (mousemove)="visCursorX = $event.offsetX" (mouseleave)="visCursorX = undefined">
      <app-audio-waveform [audioData]="audioData" [(timeMin)]="vizTimeMin"
        [(timeMax)]="vizTimeMax"></app-audio-waveform>
      <mat-divider style="border-color: gray;"></mat-divider>
      <app-audio-spectrogram style="flex: 1;" [audioData]="audioData" [(timeMin)]="vizTimeMin" [(timeMax)]="vizTimeMax"
        [(pitchMin)]="specPitchMin" [(pitchMax)]="specPitchMax" [specDbMin]="specDbMin" [specDbMax]="specDbMax"
        [fftLgWindowSize]="specLgWindowSize" [timeStep]="specTimeStep" [fftLgExtraPad]="specLgExtraPad"
        [showPitchGrid]="showPitchGrid" [pitchLabelType]="pitchLabelType" [showCrosshair]="showCrosshair"
        [showOvertones]="showOvertones" [debug_downsample]="debug_downsample"></app-audio-spectrogram>
      <div class="crosshair" style="width: 1px; background-color: red;" [style.left.%]="playheadPosPct"
        [hidden]="!audioBufSrcNode"></div>
      <div class="crosshair" style="width: 1px;" [style.left.px]="visCursorX || 0"
        [hidden]="!showCrosshair || visCursorX === undefined"></div>
    </div>
  </div>
  <div class="groove-border settings-panel" style="flex: 1; padding: 4px 8px; display: flex; flex-direction: column;">
    <div style="display: flex; align-items: center;">
      <button mat-raised-button color="primary" (click)="fileInput.click()">Set Music</button>
      <input #fileInput type="file" hidden (change)="onFileSelected($event)" accept="audio/*">
      <div style="flex: 1; padding: 0 16px; display: flex;">
        <button mat-icon-button aria-label="Play" (click)="startPlayback()" [disabled]="!audioFile">
          <mat-icon>play_arrow</mat-icon>
        </button>
        <button mat-icon-button aria-label="Stop" (click)="stopPlayback()" [disabled]="!audioBufSrcNode">
          <mat-icon>stop</mat-icon>
        </button>
        <div style="padding: 4px" [hidden]="!loading">
          <mat-progress-spinner mode="indeterminate" style="width: 40px; height: 40px"></mat-progress-spinner>
        </div>
      </div>
    </div>
    <div style="padding: 16px 0; display: flex; flex-direction: column;">
      <label>
        Spectral Power Scale
        <mat-slider min="-100" max="10" step="1">
          <input matSliderStartThumb [value]="specDbMin" (input)="specDbMin=evVal($event)">
          <input matSliderEndThumb [value]="specDbMax" (input)="specDbMax=evVal($event)">
        </mat-slider>
      </label>
      <label>
        Time vs. Frequency Resolution
        <mat-slider min="10" max="16" step="0.5">
          <input matSliderThumb [(value)]="specLgWindowSize">
        </mat-slider>
      </label>
      <label>
        Time Sampling
        <mat-slider min="0" [max]="TIME_STEP_INPUT_MAX" step="1">
          <input matSliderThumb [(value)]="specTimeStepInput">
        </mat-slider>
      </label>
      <label>
        Freqency Sampling
        <mat-slider min="-1" max="3" step="1">
          <input matSliderThumb [(value)]="specLgExtraPad">
        </mat-slider>
      </label>
      <label class="inline-comp">
        Cursor Crosshair
        <mat-slide-toggle [(ngModel)]="showCrosshair"></mat-slide-toggle>
      </label>
      <label class="inline-comp">
        Cursor Overtones
        <mat-slide-toggle [(ngModel)]="showOvertones" [disabled]="!showCrosshair"></mat-slide-toggle>
      </label>
      <label class="inline-comp">
        Pitch Grid
        <mat-slide-toggle [(ngModel)]="showPitchGrid"></mat-slide-toggle>
      </label>
      <label class="inline-comp">
        Pitch Labels
        <mat-button-toggle-group [(ngModel)]="pitchLabelType">
          <mat-button-toggle value="none">None</mat-button-toggle>
          <mat-button-toggle value="midi">MIDI</mat-button-toggle>
          <mat-button-toggle value="sharp">&sharp;</mat-button-toggle>
          <mat-button-toggle value="flat">&flat;</mat-button-toggle>
        </mat-button-toggle-group>
      </label>
      <label style="display: none;" class="inline-comp">
        [DEBUG] downsample
        <mat-button-toggle-group [(ngModel)]="debug_downsample">
          <mat-button-toggle value="0">0</mat-button-toggle>
          <mat-button-toggle value="1">1</mat-button-toggle>
          <mat-button-toggle value="2">2</mat-button-toggle>
        </mat-button-toggle-group>
      </label>
    </div>
    <div style="margin-top: auto;">
      <div> Secure context: {{ secCtx }} </div>
      <div> Cross-origin isolated: {{ coi }} </div>
      <div> AudioContext sample rate: {{ audioContext.sampleRate }} </div>
      <div> Hardware concurrency: {{ hwCcur }} </div>
    </div>
  </div>
</div>
